!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.CTS=b()}(this,function(){"use strict";var a=function(){return{}};return new a}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){"use strict";function b(a,b,i){var j={};return("undefined"==typeof b||3!==b&&5!==b)&&(b=3),"undefined"==typeof i&&(j.namespace=3===b?"http://chs.harvard.edu/xmlns/cts3/ti":"http://chs.harvard.edu/xmlns/cts"),j.version=b,j.endpoint=a,j.inventories={},j.inventory={},j.setEndpoint=d,j.addInventory=f,j.setInventory=e,j.delInventory=g,j.load=h,j.xhr=c,j.TextInventory=3===j.version?l:null,j}var c=function(a,b,c,d){var e;if("undefined"==typeof d&&(d=!0),window&&window.XMLHttpRequest)e=new XMLHttpRequest;else{if(!window||!window.ActiveXObject)return null;var f,g;if(window.ActiveXObject){f=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(g in f)try{return new ActiveXObject(f[g])}catch(h){}}}try{e.open(a,b,d),e.onreadystatechange=function(){4===e.readyState&&"function"==typeof c&&c(e.responseXML)},e.send()}catch(i){console.error(i)}},d=function(a){"string"==typeof a?this.endpoint=[a]:"array"==typeof a&&(this.endpoint=a)},e=function(a){this.inventory=a},f=function(a,b){if("string"!=typeof a)throw"Name is not a string";this.inventory[a]="undefined"==typeof b?a:b},g=function(a){if(!("string"==typeof a&&a in self.inventory))throw a+" is not in known inventories.";delete self.inventory[a]},h=function(a,b){var a,c=this.endpoint,d=(this.xhr,this);if("undefined"==typeof b)var b=Object.keys(this.inventory);if("function"==typeof a)var a=a;else var a=null;return this.xhr("GET",c+"request=GetCapabilities&inv="+b[0],function(c){d.inventories[b[0]]=new d.TextInventory(c,d.namespace,b[0]),1===b.length?null!==a&&a():(b.shift(),d.load(a,b))}),this},i=function(a,b,c){var d={};return d.type=b,d.descriptions={},d.urn=c+"."+a.getAttribute("projid").split(":")[1],d.citations=[].map.call(a.getElementsByTagName("citation"),function(a){return a.getAttribute("label")||"Unknown"}),[].map.call(a.getElementsByTagName("description"),function(a){d.defaultLang=a.getAttribute("xml:lang"),d.descriptions[d.defaultLang]=a.textContent}),d.getDesc=function(a){if("undefined"===a)a=this.defaultLang;else if(!(a in this.descriptions))return this.descriptions[this.defaultLang];return this.descriptions[a]},d},j=function(a,b){var c={};return c.label={},c.urn=b+"."+a.getAttribute("projid").split(":")[1],[].map.call(a.getElementsByTagName("title"),function(a){c.defaultLang=a.getAttribute("xml:lang"),c.label[c.defaultLang]=a.textContent}),c.getTitle=function(a){if("undefined"===a)a=this.defaultLang;else if(!(a in this.label))return this.label[this.defaultLang];return this.label[a]},c._Translation=function(a){return i(a,"translation",c.urn)},c._Edition=function(a){return i(a,"edition",c.urn)},c.editions=[].map.call(a.getElementsByTagName("edition"),c._Edition),c.translations=[].map.call(a.getElementsByTagName("translation"),c._Translation),c.texts=c.translations.concat(c.editions),c},k=function(a){var b={};return b.label={},b.urn=a.getAttribute("projid"),[].map.call(a.getElementsByTagName("groupname"),function(a){b.defaultLang=a.getAttribute("xml:lang"),b.label[b.defaultLang]=a.textContent}),b.getName=function(a){if("undefined"===a)a=this.defaultLang;else if(!(a in this.label))return this.label[this.defaultLang];return this.label[a]},b._Work=j,b.works=[].map.call(a.getElementsByTagName("work"),function(a){return b._Work(a,b.urn)}),b},l=function(a,b,c){var d,e={};return e.identifier=c,e.namespace=b,d=a.getElementsByTagNameNS(e.namespace,"TextInventory"),e._TextGroup=k,e.textgroups=1==d.length?[].map.call(d[0].getElementsByTagNameNS(e.namespace,"textgroup"),e._TextGroup):[],e.getRaw=function(a){var b={};return e.textgroups.forEach(function(c){var d=c.getName(a);b[d]={},c.works.forEach(function(c){var e=c.getTitle(a);b[d][e]={editions:{},translations:{}},c.editions.forEach(function(c){b[d][e].editions[c.getDesc(a)]=c}),c.translations.forEach(function(c){b[d][e].translations[c.getDesc(a)]=c})})}),b},e};a.repository=b});