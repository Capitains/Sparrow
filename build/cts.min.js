!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.CTS=b()}(this,function(){"use strict";var a=function(){return{}};return new a}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){var b=function(b,c,d){var e;if(void 0===typeof d&&(d={}),"undefined"==typeof d.type&&(d.type="text/xml"),"undefined"==typeof d.async&&(d.async=!0),window&&window.XMLHttpRequest)e=new XMLHttpRequest;else{if(!window||!window.ActiveXObject)return null;var f,g;if(window.ActiveXObject){f=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(g in f)try{return new ActiveXObject(f[g])}catch(h){}}}try{e.open(b,c,d.async),e.onerror=function(){"function"==typeof d.error&&d.error(e.status,e.statusText)},e.onreadystatechange=function(){500===e.status||401===e.status||403===e.status||404===e.status||400===e.status?"function"==typeof d.error&&d.error(e.status,e.statusText):4===e.readyState&&"function"==typeof d.success&&("text/xml"===d.type?d.success(e.responseXML):("text"===d.type||"plain/text"===d.type)&&d.success(e.responseText))},"undefined"==typeof d.data&&null===d.data||"POST"!==b?e.send():(e.overrideMimeType("multipart/form-data"),e.setRequestHeader("Content-type","application/x-www-form-urlencoded;"),e.send(a.utils.dataEncode(d.data)))}catch(i){"function"==typeof d.error&&d.error(i)}},c=function(b){return"string"==typeof b?new a.endpoint["default"](b):b instanceof Object?b:null},d=function(a){var b="",c=[];return Object.keys(a).forEach(function(b){Array.isArray(a[b])?a[b].forEach(function(a){c.push(encodeURIComponent(b)+"[]="+encodeURIComponent(a))}):c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]))}),b=c.join("&").replace(/%20/g,"+")},e=function(a){if("string"==typeof a)var b=a.toLowerCase().match("[a-z]{1}");if(isNaN(a)){if(null!==b&&b[0].length===a.length){var c={a:1,b:2,c:3,d:4,e:5,f:6,g:7,h:8,i:9,j:10,k:11,l:12,m:13,n:14,o:15,p:16,q:17,r:18,s:19,t:20,u:21,v:22,w:23,x:24,y:25,z:26};return c[a]}var d=a.toLowerCase().match("([0-9]*)([a-z]*)([0-9]*)([a-z]*)([0-9]*)");if(null===d)return 0;for(var d=d.map(function(b){return b.length>0&&b!=a?b:void 0}),e=[],f=0;f<d.length;f++)d[f]&&e.push(d[f]);return e}return parseInt(a)},f=function(b,c){for(var d,e,f=!1,g=0;g<=c.length-1;g++){var d=a.utils.parseInt(b[g]),e=a.utils.parseInt(c[g]);if(Array.isArray(d)&&Array.isArray(e)){if(f=a.utils.validPassage(d,e),f===!0)break}else{if(e>d){f=!0;break}if(d>e)break}}return f},g=function(){var a={},b=window.location.search.split(/\?|\&/);return b.forEach(function(b){if(b){var c=b.split("=");a[c[0]]=c[1]}}),a};a.utils={xhr:b,dataEncode:d,checkEndpoint:c,parseInt:e,validPassage:f,uriParam:g}}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.service={services:{}};var b=function(a,b){this.options[a].value=b},c=function(){var a={},b=this;return Object.keys(b.options).forEach(function(c){a[c]="undefined"!=typeof b.options[c].value?b.options[c].value:b.options[c]["default"]}),a},d=function(){return this.options},e=function(b,c){"undefined"==typeof c&&(c="text/xml"),a.utils.xhr(this.method,this.endpoint,{success:function(a){"function"==typeof b&&b(a)},type:c,data:this.getValues()})};a.service._service=function(a){this.endpoint=a,this.method="GET",this.options={},this.setValue=b,this.getValues=c,this.getOptions=d,this.send=e},a.service._service.prototype.toString=function(){return"[object CTS.Service]"},a.service["new"]=function(a,b,c){if("string"==typeof a){if(a in this.services)return new this.services[a](b,c);throw a+" is Unknown."}}}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.xslt={},a.xslt.stylesheets={};var b=function(a){"string"==typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml"));var b=new XSLTProcessor;return b.importStylesheet(a),this.processor=b,b},c=function(){var a=this.endpoint,b=new XMLHttpRequest;if(b.overrideMimeType&&b.overrideMimeType("text/xml"),b.open("GET",a,!1),b.send(null),200!=b.status)throw"Can't get transform at "+a;return this.stylesheeting(b.responseXML)},d=function(a,b){this.options[a].value=b},e=function(){var a,b={},c=this;return Object.keys(c.options).forEach(function(d){a="function"==typeof c.options[d]["default"]?c.options[d]["default"]():c.options[d]["default"],b[d]="undefined"!=typeof c.options[d].value?c.options[d].value:a}),b},f=function(){return this.options},g=function(a){var b,c,d;return this.processor||this.load(),d=this.processor,"string"==typeof a&&(a=(new DOMParser).parseFromString(a,"text/xml")),c=this.getValues(),Object.keys(c).forEach(function(a){d.setParameter(null,a,c[a])}),b=d.transformToDocument(a)};a.xslt.XSLT=function(a){this.endpoint=a,this.processor=null,this.setValue=d,this.getValues=e,this.getOptions=f,this.transform=g,this.stylesheeting=b,this.load=c},a.xslt.XSLT.prototype.toString=function(){return"[object CTS.XSLT]"},a.xslt["new"]=function(a,b,c){if("string"==typeof a){if(a in this.stylesheets)return new this.stylesheets[a](b,c);throw a+" is Unknown."}throw"@param xslt is not a string"},a.xslt.register=function(b,c){var d=function(){a.xslt.XSLT.call(this),this.options=c};return d.prototype=Object.create(a.xslt.XSLT),a.xslt.stylesheets[b]=d,a.xslt.stylesheets[b]}}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.endpoint={},a.endpoint.Endpoint=function(b,c){this.url=b,this.inventory="undefined"!=typeof c?c:null,this.getCapabilitiesURL=function(){throw"Unsupported request"},this.getDescriptionURL=function(){throw"Unsupported request"},this.getPrevNextUrnURL=function(){throw"Unsupported request"},this.getValidReffURL=function(){throw"Unsupported request"},this.getPassageURL=function(){throw"Unsupported request"},this.getPassagePlusURL=function(){throw"Unsupported request"},this.getCapabilities=function(){throw"Unsupported request"},this.getDescription=function(){throw"Unsupported request"},this.getPrevNextUrn=function(){throw"Unsupported request"},this.getValidReff=function(){throw"Unsupported request"},this.getPassage=function(){throw"Unsupported request"},this.getPassagePlus=function(){throw"Unsupported request"},this.getRequest=function(b,c){a.utils.xhr("GET",b,{success:c.success,error:c.error,type:c.type})},this.postRequest=function(b,c){a.utils.xhr("POST",b,{success:c.success,error:c.error,data:c.data,type:c.type})}},a.endpoint.Endpoint.prototype=Object.create(a.endpoint.Endpoint),a.endpoint.XQ=function(b,c){a.endpoint.Endpoint.call(this),"?"!==b.slice(-1)&&(b+="?"),this.url=b,this.inventory="undefined"!=typeof c?c:null,this.getUrl=function(a){var b=[];return Object.keys(a).forEach(function(c){b.push(c+"="+a[c])}),this.url+b.join("&")},this.getCapabilitiesURL=function(a){var b={request:"GetCapabilities"};return("undefined"!=typeof a&&null!==a||null!==this.inventory)&&(b.inv="undefined"!=typeof a&&null!==a?a:this.inventory),this.getUrl(b)},this.getCapabilities=function(a,b){"string"!=typeof a&&(b=a,a=null),this.getRequest(this.getCapabilitiesURL(a),b)},this.getPassageURL=function(a,b){var c={request:"GetPassage",urn:a};return("undefined"!=typeof b&&null!==b||null!==this.inventory)&&(c.inv="undefined"!=typeof b&&null!==b?b:this.inventory),this.getUrl(c)},this.getPassage=function(a,b){"undefined"==typeof b&&(b={}),this.getRequest(this.getPassageURL(a,b.inventory),b)},this.getValidReffURL=function(a,b){var c={request:"GetValidReff",urn:a};return"undefined"==typeof b&&(b={}),"undefined"!=typeof b.level&&(c.level=b.level),("undefined"!=typeof b.inventory&&null!==b.inventory||null!==this.inventory)&&(c.inv="undefined"!=typeof b.inventory&&null!==b.inventory?b.inventory:this.inventory),this.getUrl(c)},this.getValidReff=function(a,b){"undefined"==typeof b&&(b={}),this.getRequest(this.getValidReffURL(a,b),b)}},a.endpoint.XQ.prototype=Object.create(a.endpoint.Endpoint),a.endpoint["default"]=a.endpoint.XQ}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.text={};var b=function(a){var b,c=this.document;return null!==this.text?this.text:("undefined"==typeof a&&(a=["note","bibl","head"]),a.forEach(function(a){for(var b=c.getElementsByTagName(a);b[0];)b[0].parentNode.removeChild(b[0])}),b=c.getElementsByTagName("text")[0].textContent)},c=function(a){this.text=a},d=function(b){var c=this;"undefined"==typeof b&&(b={}),endpoint="undefined"==typeof b.endpoint?this.endpoint:a.utils.checkEndpoint(b.endpoint),endpoint.getPassage(this.urn,{inventory:this.inventory,success:function(a){c.xml=a,c.document=(new DOMParser).parseFromString(a,"text/xml"),"function"==typeof b.success&&b.success(a)},type:"plain/text",error:b.error})},e=function(){var a,b=this;try{return a=b.getXml("body"),0===a[0].childNodes.length?!1:!0}catch(c){return!1}},f=function(a,b){var c,d=this,e=!1;if(("string"!=typeof b||"xml"!==b&&"string"!==b)&&(b="xml"),"string"!=typeof a?c=d.document:(c=d.document.getElementsByTagName(a),e=!0),"string"===b){var f=new XMLSerializer;return e===!0?[].map.call(c,function(a){return f.serializeToString(a)}).join("\n"):f.serializeToString(c)}return c};a.text.Passage=function(g,h,i){"string"!=typeof i&&(i=null),this.document=null,this.xml=null,this.text=null,this.urn=g,this.inventory=i,this.endpoint=a.utils.checkEndpoint(h),this.retrieve=d,this.setText=c,this.getText=b,this.getXml=f,this.checkXML=e},a.text.Text=function(b,c,d){"string"!=typeof d&&(d=null),this.urn=b,this.inventory=d,this.endpoint=a.utils.checkEndpoint(c),this.reffs={},this.getPassage=function(a,b){return"undefined"==typeof b&&2==a.split("-").length&&(b=a.split("-")),[a,b]},this.getValidReff=function(){throw"Not Implemented Yet"}}}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){"use strict";a.repository={},a.repository.Prototypes={},a.repository.Prototypes.Text=function(a){this.descriptions={},this.titles={},this.urn="",this.citations=[],this.defaultLangDesc,this.defaultLangLabel,this.type=a,this.lang="",this.getDesc=function(a){if("undefined"===a)a=this.defaultLangDesc;else if(!(a in this.descriptions))return this.descriptions[this.defaultLangDesc];return this.descriptions[a]},this.getTitle=function(a){if("undefined"===a)a=this.defaultLangLabel;else if(!(a in this.titles))return this.titles[this.defaultLangLabel];return this.titles[a]}},a.repository.Prototypes.Work=function(){this.titles={},this.urn="",this.defaultLang="",this.lang="",this.editions=[],this.translations=[],this.texts=[],this.getTitle=function(a){if("undefined"===a)a=this.defaultLang;else if(!(a in this.titles))return this.titles[this.defaultLang];return this.titles[a]},this.toTheoretical=function(){var b=new a.repository.Prototypes.Text;return b.urn=this.urn,b.defaultLangLabel=this.defaultLang,b.titles=this.titles,b.lang=this.lang,b}},a.repository.Prototypes.TextGroup=function(){this.titles={},this.urn="",this.defaultLang="",this.works=[],this.getTitle=function(a){if("undefined"===a)a=this.defaultLang;else if(!(a in this.titles))return this.titles[this.defaultLang];return this.titles[a]}},a.repository.Prototypes.TextInventory=function(a){this.identifier=a,this.namespace="",this.textgroups=[],this.getRaw=function(a,b){"undefined"==typeof b&&(b=!1);var c={};return this.textgroups.forEach(function(d){var e=d.getTitle(a);c[e]={},d.works.forEach(function(d){var f=d.getTitle(a);c[e][f]={edition:{},translation:{}},d.editions.forEach(function(b){c[e][f].edition[b.getTitle(a)]=b}),d.translations.forEach(function(b){c[e][f].translation[b.getTitle(a)]=b}),b===!0&&(c[e][f].theoretical={},c[e][f].theoretical[f]=d.toTheoretical())})}),c}},a.repository.Prototypes.cts3={},a.repository.Prototypes.cts3.Text=function(b,c,d){a.repository.Prototypes.Text.call(this,c),this.urn=d+"."+b.getAttribute("projid").split(":")[1],this.citations=[].map.call(b.getElementsByTagName("citation"),function(a){return a.getAttribute("label")||"Unknown"});for(var e=b.getElementsByTagName("description"),f=e.length-1;f>=0;f--)this.defaultLangDesc=e[f].getAttribute("xml:lang"),this.descriptions[this.defaultLangDesc]=e[f].textContent;for(var g=b.getElementsByTagName("label"),f=g.length-1;f>=0;f--)this.defaultLangLabel=g[f].getAttribute("xml:lang"),this.titles[this.defaultLangLabel]=g[f].textContent},a.repository.Prototypes.cts3.Text.prototype=Object.create(a.repository.Prototypes.Text.prototype),a.repository.Prototypes.cts3.Edition=function(b,c,d){a.repository.Prototypes.cts3.Text.call(this,b,"edition",c),this.lang=d},a.repository.Prototypes.cts3.Edition.prototype=Object.create(a.repository.Prototypes.cts3.Text.prototype),a.repository.Prototypes.cts3.Translation=function(b,c){a.repository.Prototypes.cts3.Text.call(this,b,"translation",c),this.lang=b.getAttribute("xml:lang")},a.repository.Prototypes.cts3.Translation.prototype=Object.create(a.repository.Prototypes.cts3.Text.prototype),a.repository.Prototypes.cts3.Work=function(b,c){a.repository.Prototypes.Work.call(this),this.urn=c+"."+b.getAttribute("projid").split(":")[1],this.lang=b.getAttribute("xml:lang");for(var d=b.getElementsByTagName("title"),e=d.length-1;e>=0;e--)this.defaultLang=d[e].getAttribute("xml:lang"),this.titles[this.defaultLang]=d[e].textContent;for(var f=b.getElementsByTagName("edition"),e=f.length-1;e>=0;e--)this.editions.push(new a.repository.Prototypes.cts3.Edition(f[e],this.urn,this.lang));for(var g=b.getElementsByTagName("translation"),e=g.length-1;e>=0;e--)this.translations.push(new a.repository.Prototypes.cts3.Translation(g[e],this.urn));this.texts=this.translations.concat(this.editions)},a.repository.Prototypes.cts3.Work.prototype=Object.create(a.repository.Prototypes.Work.prototype),a.repository.Prototypes.cts3.TextGroup=function(b){a.repository.Prototypes.TextGroup.call(this),this.urn="urn:cts:"+b.getAttribute("projid");for(var c=b.getElementsByTagName("groupname"),d=c.length-1;d>=0;d--)this.defaultLang=c[d].getAttribute("xml:lang"),this.titles[this.defaultLang]=c[d].textContent;for(var e=b.getElementsByTagName("work"),d=e.length-1;d>=0;d--)this.works.push(new a.repository.Prototypes.cts3.Work(e[d],this.urn))},a.repository.Prototypes.cts3.TextGroup.prototype=Object.create(a.repository.Prototypes.TextGroup.prototype),a.repository.Prototypes.cts3.TextInventory=function(b,c,d){if(a.repository.Prototypes.TextInventory.call(this,d),this.xml=b,this.namespace=c,this.xml=this.xml.getElementsByTagNameNS(this.namespace,"TextInventory"),1==this.xml.length)for(var e=this.xml[0].getElementsByTagNameNS(this.namespace,"textgroup"),f=e.length-1;f>=0;f--)this.textgroups.push(new a.repository.Prototypes.cts3.TextGroup(e[f]))},a.repository.Prototypes.cts3.TextInventory.prototype=Object.create(a.repository.Prototypes.TextInventory.prototype);var b=function(a){"string"==typeof a?this.endpoint=[a]:"array"==typeof a&&(this.endpoint=a)},c=function(a){this.inventory=a},d=function(a,b){if("string"!=typeof a)throw"Name is not a string";this.inventory[a]="undefined"==typeof b?a:b},e=function(a){if(!("string"==typeof a&&a in self.inventory))throw a+" is not in known inventories.";delete this.inventory[a]},f=function(b,c,d){var e=(this.endpoint,a.utils.xhr,this);if("undefined"==typeof d)var d=Object.keys(this.inventory);if("function"!=typeof b)var b=null;if("function"!=typeof c)var c=function(){};return this.endpoint.getCapabilities(d[0],{success:function(a){e.inventories[d[0]]=new e.TextInventory(a,e.namespace,d[0]),1===d.length?null!==b&&b():(d.shift(),e.load(b,c,d))},error:c,type:"text/xml"}),this};a.repository.repository=function(g,h,i){("undefined"==typeof h||3!==h&&5!==h)&&(h=3),this.namespace="undefined"==typeof i?3===h?"http://chs.harvard.edu/xmlns/cts3/ti":"http://chs.harvard.edu/xmlns/cts":i,this.version=h,this.endpoint=a.utils.checkEndpoint(g),this.inventories={},this.inventory={},this.setEndpoint=b,this.addInventory=d,this.setInventory=c,this.delInventory=e,this.load=f,this.TextInventory=a.repository.Prototypes["cts"+this.version].TextInventory}}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){"use strict";var b=function(b,c){return"undefined"!=typeof c&&c in a.lang.lexicons||(c="en"),b in a.lang.lexicons[c]?a.lang.lexicons[c][b]:a.lang.lexicons.en[b]};a.lang={get:b,lexicons:{}}}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.service.services["llt.tokenizer"]=function(b,c){a.service._service.call(this,b,c),this.method="POST",this.options={xml:{type:"boolean",html:"checkbox","default":!1},inline:{type:"boolean",html:"hidden","default":!0},splitting:{type:"boolean",html:"checkbox","default":!0},merging:{type:"boolean",html:"checkbox","default":!1},shifting:{type:"boolean",html:"checkbox","default":!1},text:{type:"text",html:"textarea"},remove_node:{type:"list",html:"input","default":["teiHeader","head","speaker","note","ref"]},go_to_root:{type:"string",html:"input","default":"TEI"},ns:{type:"string",html:"input","default":"http://www.tei-c.org/ns/1.0"}}},a.service.services["llt.tokenizer"].prototype=Object.create(a.service._service)}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.endpoint.simpleUrl=function(b,c){a.endpoint.Endpoint.call(this),this.url=b,this.inventory="undefined"!=typeof c?c:null,this.getUrl=function(){return this.url},this.getCapabilitiesURL=function(){return this.getUrl()},this.getCapabilities=function(a,b){this.getRequest(this.url,b)},this.getPassageURL=function(){return this.getUrl()},this.getPassage=function(a,b){this.getRequest(this.url,b)},this.getValidReffURL=function(){return this.getUrl()},this.getValidReff=function(a,b){this.getRequest(this.url,b)}},a.endpoint.simpleUrl.prototype=Object.create(a.endpoint.Endpoint)}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){a.xslt.stylesheets["llt.segtok_to_tb"]=function(b,c){a.xslt.XSLT.call(this,b,c),this.options={e_lang:{type:"string",html:"input","default":"lat"},e_format:{type:"string",html:"input","default":"aldt"},e_docuri:{type:"string",html:"input","default":""},e_agenturi:{type:"string",html:"input","default":"http://services.perseids.org/llt/segtok"},e_appuri:{type:"string",html:"input","default":""},e_datetime:{type:"string",html:"hidden","default":function(){return(new Date).toDateString()}},e_collection:{type:"string",html:"input","default":"urn:cite:perseus:lattb"},e_attachtoroot:{type:"boolean",html:"checkbox","default":!1}}},a.xslt.stylesheets["llt.segtok_to_tb"].prototype=Object.create(a.xslt.XSLT)}),function(a){"function"==typeof define&&define.amd?define(["cts"],a):a(CTS)}(function(a){"use strict";var b={translation:"Translation",edition:"Edition",theoretical:"Theoretical Work",select:"Select",start_passage:"Beginning of passage",stop_passage:"End of passage",retrieve_passage:"Retrieve passage",loading:"Loading...","llt.tokenizer":"Tokenizer parameters","llt.tokenizer.xml":"XML Formatted input","llt.tokenizer.inline":"?","llt.tokenizer.splitting":"Split Enclytics","llt.tokenizer.merging":"Merge split words","llt.tokenizer.shifting":"Shift Enclytics","llt.tokenizer.text":"Text to tokenize","llt.tokenizer.remove_node":"Nodes to remove from XML","llt.tokenizer.go_to_root":"Name of the root node","llt.tokenizer.ns":"Namespace of the XML","llt.segtok_to_tb":"Treebank Parameters","llt.segtok_to_tb.e_lang":"Language","llt.segtok_to_tb.e_format":"Treebank grammar","llt.segtok_to_tb.e_docuri":"Document URI","llt.segtok_to_tb.e_agenturi":"Agent URI","llt.segtok_to_tb.e_appuri":"Application URI","llt.segtok_to_tb.e_datetime":"Date","llt.segtok_to_tb.e_collection":"Collection","llt.segtok_to_tb.e_attachtoroot":"Attach to the root"};a.lang.lexicons.en=b});